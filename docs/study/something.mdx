---
title: 브라우저는 출처가 다를 떄 어떻게 스토리지를 따로 만들어주지?
sidebar_position: 2
last_update:
  date: 10/15/2025
description: 생각해보니 SQL 제대로 써본 적이 없잖아?
tags: [스터디]
draft: true
---

## 개요

postMessage를 활용하여 다른 출처간 데이터를 교류하면서 갑자기 궁금한게 생겼다. 어떻게 브라우저는 다른 출처에 대해 다른 스토리지를 자동으로 제공해주는걸까? 신기했다. 그래서 시작된 호기심 시작해보자.

조금 더 궁금증 및 호기심 질문 던져보자.

브라우저는 출처를 key로 사용한다

브라우저 Local / session 접근할때 다음과 같은 논리적 단계 따름

1. 출처 문자열 생성
2. 스토리지 DB 조회 : 출처 문자열 key로 사용하는 (SQLite 같은 파일 기반 DB) 스토리지 DB 조회
3. 데이버 접근

### 크롬에선?

- 다중 프로세스 아키텍쳐
- IPC (Inter-process Communication)

### 다중 프로세스 아키텍쳐

코드 실행 / 실제 데이터를 저장 주체 서로 다른 프로세스라는 것

1. 렌더러 프로세스

- 보고 있는 탭이 해당
- localStorage.setItem이 실행되는 곳
- 보안 위해 샌드박스 안에 격리되어 있다.
  - 이 프로세스는 사용자의 하드디스크에 직접 파일을 쓰거나 읽을 수 없다.

2. 브라우저 프로세스

- 크롬의 본체
- 주소창, 탭관리, 북마크, 모든 파일/네트워크/저장소 접근을 총괄
- 이 프로세스만 유일하게 사용자의 디스크에 데이터를 write할 권한이 있음.

그런데 통신은 어떻게 해? (IPC / Mojo)
localStorage.setItem('user','guest'); 코드가 렌더러 프로세스에서 실행되면 다음과 같은 일

1. 렌더러 프로세스 권한 없음
2. 렌더러 프로세스 -> 브라우저 프로세스로 메ㅅ시지 보냄. (Mojo를 활용)
3. 브라우저는 요청을 받음
4. 브라우저는 물리적인 데이터 베이스 파일에 접근
5. 크로미움은 출처별 저장소를 관리하기 위해 LevelDb 혹은 SQLite 데이터 베이스 엔진 사용

-> 여러분의 컴퓨터 하드디스크 어딘가(프로필 폴더 안)에 Local Storage 전용 데이터베이스 파일(혹은 폴더)이 있습니다.

`/Users/juyoung/Library/Application Support/Google/Chrome/Profile 1/Local Storage/leveldb``

```
// *.ldb
==============================
[KEY]: _https://example.com:8080@1user
[VALUE]: "guest"
==============================

==============================
[KEY]: _https://example.com:8080@1theme
[VALUE]: "dark"
==============================

==============================
[KEY]: _https://example.com:3000@1user
[VALUE]: "admin"
==============================
```

## 아하 모먼트

- 엇 결국 iframe window 통신도 IPC인가?
- 결국 브라우저는 사용하는 사람들의 컴퓨터에 무언가 파일을 만들어서 기능을 표현한것이구나?!
